<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carga de Facturas desde CSV</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div class="container">
        <h1>üìÇ Carga de Facturas desde CSV</h1>
        
        <!-- Mensajes de alerta -->
        <div th:if="${error}" class="alert alert-error">
            ‚ùå <span th:text="${error}"></span>
        </div>
        
        <div th:if="${exito}" class="alert alert-success">
            ‚úÖ <span th:text="${exito}"></span>
        </div>
        
        <div th:if="${advertencia}" class="alert alert-warning">
            ‚ö†Ô∏è <span th:text="${advertencia}"></span>
        </div>
        
        <!-- Formulario de subida -->
        <form class="upload-form" method="post" action="/upload-csv" enctype="multipart/form-data">
            <div class="form-group">
                <label for="file">Selecciona un archivo CSV de facturas:</label>
                <input type="file" id="file" name="file" accept=".csv" required>
            </div>
            <button type="submit">üì§ Subir y Procesar Facturas</button>
        </form>
        
        <!-- Resultados del procesamiento -->
        <div class="results" th:if="${registrosExitosos != null}">
            <div class="stats">
                <div class="stat-box success">
                    <div class="stat-number" th:text="${registrosExitosos}">0</div>
                    <div class="stat-label">Facturas Guardadas</div>
                </div>
                <div class="stat-box error">
                    <div class="stat-number" th:text="${totalErrores}">0</div>
                    <div class="stat-label">Errores Encontrados</div>
                </div>
            </div>
            
            <!-- Lista de errores detallada -->
            <div class="error-list" th:if="${errores != null && !errores.isEmpty()}">
                <h3>üìã Detalle de Errores:</h3>
                <ul>
                    <li th:each="error : ${errores}" th:text="${error}"></li>
                </ul>
            </div>
        </div>
        
        <!-- Informaci√≥n sobre el formato CSV -->
        <div class="info-box">
            <p><strong>‚ÑπÔ∏è Formato del archivo CSV para Facturas de Venta:</strong></p>
            <p><strong>Columnas requeridas:</strong></p>
            <p style="font-family: monospace; font-size: 12px; background: #f0f0f0; padding: 8px; border-radius: 4px; overflow-x: auto;">
                numeroFactura,serie,pedidoId,clienteId,fechaEmision,fechaVencimiento,estadoPago,baseImponible,ivaTotal,totalFactura,moneda,usuarioEmisorId
            </p>
            
            <p><strong>Campos obligatorios:</strong> numeroFactura, serie, clienteId, fechaEmision, estadoPago, baseImponible, ivaTotal, totalFactura, moneda</p>
            
            <p><strong>Campos opcionales:</strong> pedidoId, fechaVencimiento, usuarioEmisorId</p>
            
            <p><strong>Estados de pago v√°lidos:</strong> pendiente, pagada, parcial, vencida, anulada</p>
            
            <p><strong>Validaci√≥n autom√°tica:</strong> totalFactura debe ser igual a baseImponible + ivaTotal</p>
            
            <p><strong>Formato de fechas:</strong> YYYY-MM-DD (ejemplo: 2026-01-15)</p>
            
            <p><strong>Ejemplo de l√≠nea v√°lida:</strong></p>
            <p style="font-family: monospace; font-size: 12px; background: #e7f3ff; padding: 8px; border-radius: 4px; overflow-x: auto;">
                FAC-2026-001,A,1,1,2026-01-15,2026-02-15,pendiente,1000.00,210.00,1210.00,EUR,1
            </p>
        </div>
    </div>
</body>
</html>
